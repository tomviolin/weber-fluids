<!DOCTYPE html>
<!-- saved from url=(0022)http://localhost:8000/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Fluid Dynamics Simulation</title>
<script src="./jquery-3.7.1.slim.js" integrity="sha256-UgvvN8vBkgO0luPSUl2s8TIlOSYRoGFAX4jlCIm9Adc=" crossorigin="anonymous"></script>
<!-- script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgpu@latest/dist/tf.min.js"></script>  -->
<script async src="opencv.js" type="text/javascript" onload="onOpenCvReady();" onerror="onOpenCvError();"></script>
<script src="utils.js" type="text/javascript"></script>

<script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.162.0/three.module.js" integrity="sha512-0XQNqFQUDxCJPikfkl+TwMm0YblRLrIoBb7MvYZ4Q7BUoeNBXUvW/PawMUgT2jn3w/AFTxANjy0mJ94ob215mQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<meta name="viewport" content="width=620">
<style>
	body {background-color:#ffffff; font-family:Arial, sans-serif; font-size:14px;
					text-align:center !important;}						/* gray background, center everything */
	p {margin-left:auto; margin-right:auto; width:600px;}	/* keep paragraphs narrow and centered */
	input {font-size:115%;}									/* make buttons bigger */
	input[type="range"] {width:90px;}						/* make sliders shorter */
	select {font-size:115%;}								/* make selectors bigger too */
	li {text-align:left;}
	button { display: inline-block; width: 6em; }
	button .butmoji { font-size: 200% }
	div.slider { font-size:120%; margin-top:.1em; width: 600px; display:inline-block; }
	input[type="range"] { width:300px; }
</style>
</head>

<body style="text-align: center;">

<h2>Fluid Dynamics Simulation</h2>

<p>By <a href="http://physics.weber.edu/schroeder/">Dan Schroeder</a>, 
<a href="http://physics.weber.edu/">Physics Department</a>, 
<a href="http://weber.edu/">Weber State University</a></p>
<div id="canvascon" style="position:relative; height:450px; width:100%;display:flex; justify-content:center;">
<canvas id="canvasInput" width="900" height="450" style="image-rendering: pixelated; position: absolute; top:0; left: auto; z-index:0; width:900px;height:450px;" ></canvas>
<canvas id="theCanvas" width="900" height="450" style="width:900px; height: 450px; position: absolute; top:0;left:auto; z-index: 50; background-color:transparent;">This application runs only in modern
browsers. For best results, use Google Chrome.</canvas>
<!-- canvas id="theGLCanvas" width="900" height="450" style="width:900px; height: 450px; position: absolute; top:460px;">This application runs only in modern
browsers. For best results, use Google Chrome.</canvas -->
</div>
<!-- canvas id="lic" width="900" height="450" style="pxosition: absolute; height:225px; width:450px;"></canvas>
<canvas id="lico" width="900" height="450" style="pxosition: absolute; height:225px; width:450px;"></canvas -->

<br>
<input type="file" id="fileInput" name="file" accept="image/*"/>
<p><b>Hold SHIFT to join consecutive clicks with straight lines</b></p>
<div style="margin-bottom:0.5em">
	<select id="sizeSelect" onchange="resize()" style="display: none;">
		<option value="6">100 x 40</option>
	</select>
	<script>
		/*
	var barrierSelect = document.getElementById('barrierSelect');
	for (var barrierIndex=0; barrierIndex<barrierList.length; barrierIndex++) {
		var shape = document.createElement("option");
		shape.text = barrierList[barrierIndex].name;
		barrierSelect.add(shape, null);
	} */
	</script>
	<button id="resetFluidButton" onclick="initFluid()" type="button"><div class="butmoji">⏮</div><div class="label">Reset flow</div></button>
	<button id="stepButton" type="button" onclick="simulate()"><div class="butmoji">⏯</div><div class="label">Step</div></button>
	<button id="startButton" type="button" onclick="startStop()"><div class="butmoji">⏩</div><div class="label">Run</div></button>
	<div class="spacer" style="display: inline-block; width:150px;"></div>
	<button id="drawButton" type="button" onclick="drawButton()"><div class="butmoji"><img src="./drawing.png" style="width:33px;height:33px; margin-bottom:-8px;"></div><div class="label">draw</div></button>
	<button id="eraseButton" type="button" onclick="eraseButton()"><div class="butmoji"><img src="./erase.png" style="width:33px;height:33px; margin-bottom:-8px;"></div><div class="label">erase</div></button>
	<button id="clearButton" type="button" onclick="clearBarriers()"><div class="butmoji"><img src="./eraser.png" style="width: 33px;height:33px; margin-bottom:-8px;"></div><div class="label">clear all</div></button>
</div>
<div class="slider">
	Flow speed: <span id="speedValue">0.120</span><br>
	<input id="speedSlider" type="range" min="0" max="0.06" step="0.0025" value="0.05" onmousemove="adjustSpeed()">
</div>
<br>
<div class="slider">
	Viscosity: <span id="viscValue">0.0005</span><br>
	<input id="viscSlider" type="range" min="0.0005" max="0.013" step="0.0005" value="0.0005" onmousemove="adjustViscosity()">
</div>

<div style="margin-top:3px">
	<select id="mouseSelect">
		<option value="draw">Draw barriers</option>
		<option value="erase">Erase barriers</option>
		<option value="push">Drag fluid</option>
	</select>
	<select id="barrierSelect" onchange="placePresetBarrier()">
		<option>Barrier shapes</option>
	<option>Short line</option><option>Long line</option><option>Diagonal</option><option>Shallow diagonal</option><option>Small circle</option><option>Large circle</option><option>Line with spoiler</option><option>Circle with spoiler</option><option>Right angle</option><option>Wedge</option><option>Airfoil</option></select>
</div>
<div>
	<select id="plotSelect" onchange="paintCanvas()">
		<option>Plot density</option>
		<option>Plot x velocity</option>
		<option>Plot y velocity</option>
		<option>Plot speed</option>
		<option selected="">Plot curl</option>
		<option>Plot stress</option>
	</select>
	&nbsp;&nbsp;Contrast:
	<input id="contrastSlider" type="range" min="-10" max="10" step="1" value="0" onchange="paintCanvas()" onmousemove="paintCanvas()">
</div>
<div>
	Animation speed:
	<input id="stepsSlider" type="range" min="1" max="40" step="2" value="4" onchange="resetTimer()">
	&nbsp;&nbsp;Steps/frames per second: <span id="speedReadout">117</span>
	&nbsp;&nbsp;<input id="rafCheck" type="checkbox" checked="" onchange="resetTimer()">Faster?
</div>
<div style="margin-top:4px">
	<!--<input id="pixelCheck" type="checkbox" checked onchange="resetTimer()">Use pixel graphics-->
	Show:
	<input id="tracerCheck" type="checkbox" onchange="initTracers()" >Tracers
	<input id="flowlineCheck" type="checkbox" onchange="paintCanvas()" checked>Flowlines
	<input id="forceCheck" type="checkbox" onchange="paintCanvas()">Force on barriers
	<input id="sensorCheck" type="checkbox" onchange="paintCanvas()">Sensor
	<input id="dataCheck" type="checkbox" onchange="showData()">Data
</div>
<div id="dataSection" style="display:none">
	<textarea id="dataArea" rows="8" cols="50" disabled="" readonly=""></textarea>
	<div>
		<input id="dataButton" type="button" value="Start data collection" onclick="startOrStopData()">
		<input id="periodButton" type="button" value="Show F_y period" onclick="showPeriod()">
		<input id="barrierDataButton" type="button" value="Show barrier locations" onclick="showBarrierLocations()">
		<input id="debugButton" type="button" value="Debug" onclick="debug()" style="display:none">
	</div>
</div>
<p style="text-align:left">This is a simulation of a two-dimensional fluid. Initially the fluid
is flowing from left to right, and a linear barrier (shown in black) diverts the fluid and creates 
vortices. The colors indicate the curl, or local rotational motion, of the fluid.  
Use the controls to adjust the flow speed and viscosity, draw different barriers, drag the
fluid around, plot other quantities besides the curl, show the force exerted by the fluid
on the barriers, and measure the fluid's density and velocity at any point. Enjoy!</p>

<p style="text-align:left">This simulation is intended for qualitative and semi-quantitative educational 
demonstrations—not for serious engineering use.  One obvious limitation is that it simulates
a fluid in only two dimensions rather than three.  It is also limited to modeling fluids at
constant temperature and with flow velocities that are at least a few times less than the speed of sound.
Perhaps the most important limitation, though, concerns the length and time scale.  The simulation
uses an arbitrary system of units, so the only way to compare to the real world is through the
dimensionless Reynolds number, defined as (length)(velocity)/(viscosity), where “length” 
is the characteristic size of whatever the fluid is flowing around or through.  The practical limit
on the Reynolds number in this simulation is a few hundred, whereas a typical Reynolds number for
air flowing around a bicyclist is roughly 100,000.  Higher Reynolds numbers result in more levels of
structure and turbulence in the fluid.  This simulation simply cannot handle the many high-Reynolds-number
situations that are so important in everyday life.
</p>

<p style="text-align:left">The simulation uses a fairly simple
<a href="http://en.wikipedia.org/wiki/Lattice_Boltzmann_methods">lattice-Boltzmann algorithm</a>, 
which you can see by viewing the JavaScript source code (use your browser's View Source or Page Source
menu command).  As of 2019, it runs at pleasing speeds on most personal computers in the Chrome, Firefox,
and Opera browsers.  Other browsers, not to mention mobile devices, may give inferior performance.
Some very old browsers may not even be able to display the slider controls.</p>

<p style="text-align:left">
	Related materials:
</p>
<div style="margin-left:auto; margin-right:auto; width:600px;">
	<ul>
	<li><a href="http://localhost:8000/LatticeBoltzmannDemo.java.txt">A similar simulation in Java</a></li>
	<li><a href="http://localhost:8000/LatticeBoltzmannDemo.py.txt">A similar simulation in Python</a></li>
	<li><a href="http://localhost:8000/FluidSimulationsForUndergrads.pdf">Poster presentation</a> 
	given at the AAPT summer meeting, 2013 (pdf, 2.6 MB)</li>
	<li><a href="http://physics.weber.edu/schroeder/javacourse/LatticeBoltzmann.pdf">Instructions</a> 
	for a lattice-Boltzmann project in a computational physics course</li>
	<li>A more detailed explanation of the lattice-Boltzmann algorithm (coming soon)</li>
	</ul>
</div>
<script type="module" src="index.js"></script>
<script>
	function onOpenCvReady() {
	}
	function onOpenCvError() {}
</script>
</body>
</html>
